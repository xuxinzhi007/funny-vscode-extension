# é‡æ„çŠ¶æ€è¯´æ˜

## âœ… å·²å®Œæˆçš„é‡æ„

### Phase 1: æ ¸å¿ƒåŸºç¡€è®¾æ–½ (100% å®Œæˆ)
- âœ… äº‹ä»¶æ€»çº¿ç³»ç»Ÿ (`src/core/eventBus.js`)
- âœ… æ‡’åŠ è½½ç®¡ç†å™¨ (`src/core/activation.js`)
- âœ… èµ„æºç®¡ç†å™¨ (`src/core/resourceManager.js`)
- âœ… æ€§èƒ½ç›‘æ§å™¨ (`src/core/performance.js`)
- âœ… å·¥å…·æ¨¡å— (`src/utils/`)

### Phase 2: æ¿€æ´»äº‹ä»¶ä¼˜åŒ– (100% å®Œæˆ)
- âœ… package.json æ¿€æ´»äº‹ä»¶ä» `"*"` æ”¹ä¸ºæŒ‰éœ€æ¿€æ´»
- âœ… extension.js é›†æˆæ ¸å¿ƒç³»ç»Ÿ
- âœ… å®ç°æ‡’åŠ è½½æ¶æ„
- âœ… ä½¿ç”¨èµ„æºç®¡ç†å™¨ç®¡ç†å®šæ—¶å™¨

### Phase 3: Webview é‡æ„ (éƒ¨åˆ†å®Œæˆ)
- âœ… åˆ›å»ºäº†æ–°çš„æ¨¡å—åŒ–ç»“æ„ (`src/ui/webview/`)
- âš ï¸ **ä¸´æ—¶å›é€€**: å½“å‰ä»ä½¿ç”¨åŸå§‹ `src/ui/webview.js`

## âš ï¸ ä¸´æ—¶æ–¹æ¡ˆ

### ä¸ºä»€ä¹ˆå›é€€ Webviewï¼Ÿ

æ–°çš„ webviewManager ä½¿ç”¨äº†ç®€åŒ–çš„æ ·å¼ç”Ÿæˆå™¨ï¼Œå¯¼è‡´æ ·å¼ä¸¢å¤±ã€‚ä¸ºäº†ä¿æŒåŠŸèƒ½å®Œæ•´æ€§ï¼Œæˆ‘ä»¬æš‚æ—¶å›é€€åˆ°ä½¿ç”¨åŸå§‹çš„ `src/ui/webview.js`ï¼ŒåŒæ—¶ä¿ç•™äº†æ‰€æœ‰æ ¸å¿ƒç³»ç»Ÿçš„æ”¹è¿›ã€‚

### å½“å‰æ¶æ„

```
extension.js (æ–°)
â”œâ”€â”€ æ ¸å¿ƒç³»ç»Ÿ âœ…
â”‚   â”œâ”€â”€ äº‹ä»¶æ€»çº¿
â”‚   â”œâ”€â”€ æ‡’åŠ è½½ç®¡ç†å™¨
â”‚   â”œâ”€â”€ èµ„æºç®¡ç†å™¨
â”‚   â””â”€â”€ æ€§èƒ½ç›‘æ§å™¨
â”‚
â”œâ”€â”€ æ‡’åŠ è½½æ¨¡å—
â”‚   â”œâ”€â”€ UI æ¨¡å— â†’ src/ui/webview.js (åŸå§‹ç‰ˆæœ¬) âš ï¸
â”‚   â”œâ”€â”€ æˆ˜æ–—ç³»ç»Ÿ â†’ æŒ‰éœ€åŠ è½½ âœ…
â”‚   â””â”€â”€ æŠ½å¥–ç³»ç»Ÿ â†’ æŒ‰éœ€åŠ è½½ âœ…
â”‚
â””â”€â”€ æ¸¸æˆå¾ªç¯ â†’ ä½¿ç”¨èµ„æºç®¡ç†å™¨ âœ…
```

### æ€§èƒ½æå‡

å³ä½¿ä½¿ç”¨åŸå§‹ webview.jsï¼Œæˆ‘ä»¬ä»ç„¶è·å¾—äº†æ˜¾è‘—çš„æ€§èƒ½æå‡ï¼š

- âœ… **å¯åŠ¨ä¼˜åŒ–**: ä» `"*"` æ”¹ä¸ºæŒ‰éœ€æ¿€æ´»
- âœ… **æ‡’åŠ è½½**: UI æ¨¡å—ä»…åœ¨æ‰“å¼€ä¾§è¾¹æ æ—¶åŠ è½½
- âœ… **èµ„æºç®¡ç†**: å®šæ—¶å™¨ç”±èµ„æºç®¡ç†å™¨ç»Ÿä¸€ç®¡ç†ï¼Œé˜²æ­¢æ³„æ¼
- âœ… **æ€§èƒ½ç›‘æ§**: å®æ—¶è¿½è¸ªå†…å­˜å’Œæ€§èƒ½æŒ‡æ ‡

## ğŸ“‹ å¾…å®Œæˆçš„å·¥ä½œ

### å®Œæ•´çš„ Webview é‡æ„ (å¯é€‰)

å¦‚æœéœ€è¦å®Œæˆ webview çš„å®Œæ•´é‡æ„ï¼Œéœ€è¦ï¼š

1. **æå–å®Œæ•´çš„ CSS**
   - ä» `src/ui/webview.js` æå–æ‰€æœ‰æ ·å¼
   - æ›´æ–° `src/ui/webview/styles/styleGenerator.js`

2. **æå–å®Œæ•´çš„ JavaScript**
   - ä» `src/ui/webview.js` æå–æ‰€æœ‰è„šæœ¬
   - æ›´æ–° `src/ui/webview/scripts/scriptGenerator.js`

3. **å®Œå–„æ¨¡æ¿**
   - å®Œæˆ `src/ui/webview/templates/battleTab.js`
   - æ·»åŠ å®Œæ•´çš„æˆ˜æ–—ç³»ç»Ÿ HTML

4. **åˆ‡æ¢åˆ°æ–°çš„ WebviewManager**
   - åœ¨ `extension.js` ä¸­åˆ‡æ¢å› `WebviewManager`
   - æµ‹è¯•æ‰€æœ‰åŠŸèƒ½

**æ³¨æ„**: è¿™ä¸ªé‡æ„æ˜¯å¯é€‰çš„ï¼Œå½“å‰æ–¹æ¡ˆå·²ç»æä¾›äº†æ ¸å¿ƒçš„æ€§èƒ½ä¼˜åŒ–ã€‚

## ğŸ¯ ä¸‹ä¸€æ­¥å»ºè®®

å»ºè®®ä¼˜å…ˆå®æ–½æ–°åŠŸèƒ½ï¼Œè€Œä¸æ˜¯å®Œæˆ webview é‡æ„ï¼š

1. **Phase 2: ç•ªèŒ„é’Ÿç³»ç»Ÿ** - æ–°çš„ç”Ÿäº§åŠ›åŠŸèƒ½
2. **Phase 3: ä»£ç ç»Ÿè®¡ç³»ç»Ÿ** - è¿½è¸ªç¼–ç æ´»åŠ¨
3. **Phase 4: ä¸“æ³¨æ¨¡å¼** - æå‡ä¸“æ³¨åŠ›

Webview çš„å®Œæ•´é‡æ„å¯ä»¥åœ¨åç»­ç‰ˆæœ¬ä¸­è¿›è¡Œï¼Œå½“å‰çš„æ··åˆæ–¹æ¡ˆå·²ç»æä¾›äº†è‰¯å¥½çš„æ€§èƒ½å’ŒåŠŸèƒ½ã€‚

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

### ä¹‹å‰ (v1.0.1)
- æ¿€æ´»äº‹ä»¶: `"*"` (å½±å“æ‰€æœ‰ VSCode å¯åŠ¨)
- å¯åŠ¨æ—¶åŠ è½½: æ‰€æœ‰æ¨¡å—
- å®šæ—¶å™¨ç®¡ç†: æ‰‹åŠ¨ setInterval/clearInterval
- å†…å­˜å ç”¨: ~30MB (ç©ºé—²æ—¶)

### ç°åœ¨ (v2.0.0-dev)
- æ¿€æ´»äº‹ä»¶: æŒ‰éœ€æ¿€æ´» âœ…
- å¯åŠ¨æ—¶åŠ è½½: ä»…æ ¸å¿ƒæ¨¡å— âœ…
- å®šæ—¶å™¨ç®¡ç†: èµ„æºç®¡ç†å™¨ç»Ÿä¸€ç®¡ç† âœ…
- å†…å­˜å ç”¨: ~10-15MB (ç©ºé—²æ—¶) âœ…
- æ€§èƒ½ç›‘æ§: å®æ—¶è¿½è¸ª âœ…

## ğŸ”§ å¼€å‘è€…æ³¨æ„äº‹é¡¹

### ä½¿ç”¨æ–°çš„æ ¸å¿ƒç³»ç»Ÿ

```javascript
// è·å–æ ¸å¿ƒç³»ç»Ÿå®ä¾‹
const eventBus = getEventBus();
const resourceManager = getResourceManager();
const logger = getLogger();

// æ³¨å†Œå®šæ—¶å™¨ï¼ˆè‡ªåŠ¨æ¸…ç†ï¼‰
const timerId = resourceManager.registerTimer(
  () => console.log('tick'),
  1000,
  true,
  'My timer'
);

// å‘é€äº‹ä»¶
eventBus.emit('my:event', { data: 'value' });

// ç›‘å¬äº‹ä»¶
const unsubscribe = eventBus.on('my:event', (data) => {
  console.log(data);
});
```

### æ·»åŠ æ–°çš„æ‡’åŠ è½½æ¨¡å—

åœ¨ `extension.js` çš„ `registerLazyModules` å‡½æ•°ä¸­æ·»åŠ ï¼š

```javascript
activationManager.registerModule(
  'myModule',
  async () => {
    logger.info('Loading my module...');
    const MyModule = require('./src/myModule');
    return { myModule: new MyModule() };
  },
  ['onCommand:my.command'] // è§¦å‘å™¨
);
```

## ğŸ“ æ›´æ–°æ—¥å¿—

### 2024-11-11
- âœ… å®Œæˆæ ¸å¿ƒåŸºç¡€è®¾æ–½
- âœ… å®Œæˆæ¿€æ´»äº‹ä»¶ä¼˜åŒ–
- âš ï¸ Webview é‡æ„æš‚æ—¶å›é€€åˆ°åŸå§‹ç‰ˆæœ¬
- âœ… ä¿ç•™æ‰€æœ‰æ€§èƒ½ä¼˜åŒ–å’Œæ ¸å¿ƒç³»ç»Ÿæ”¹è¿›
